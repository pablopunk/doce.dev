services:
  preview:
    build:
      context: .
      dockerfile: Dockerfile.preview
    volumes:
      - project_files:/app
      - doce-global-opencode-auth:/root/.local/share/opencode
      - pnpm-store:/root/.local/share/pnpm/store
    ports:
      - "${DEV_PORT:-4321}:4321"
    environment:
      - HOST=0.0.0.0
    networks:
      - default
      - doce-shared
  opencode:
    build:
      context: .
      dockerfile: Dockerfile.opencode
    volumes:
      - project_files:/app
      - opencode_storage:/root/.local/share/opencode
    ports:
      - "${OPENCODE_PORT:-3000}:3000"
    networks:
      - default
      - doce-shared

volumes:
  project_files:
    name: ${PROJECT_DATA_VOLUME_NAME}
  opencode_storage:
    name: doce_${PROJECT_ID}_opencode_storage
  pnpm-store:
    external: true
    name: doce-global-pnpm-store

networks:
  default:
  doce-shared:
    external: true
    name: ${DOCE_NETWORK:-doce-shared}
