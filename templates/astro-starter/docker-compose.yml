services:
  preview:
    build:
      context: .
      dockerfile: Dockerfile.preview
    volumes:
      - ${PROJECT_ID}_data:/app
      - pnpm-store:/root/.local/share/pnpm/store
    ports:
      - "${DEV_PORT:-4321}:4321"
    environment:
      - HOST=0.0.0.0
  opencode:
    build:
      context: .
      dockerfile: Dockerfile.opencode
    volumes:
      - ${PROJECT_ID}_data:/app
      - opencode-data:/root/.local/share/opencode
      - ../../opencode/auth.json:/root/.local/share/opencode/auth.json
    ports:
      - "${OPENCODE_PORT:-3000}:3000"

volumes:
  ${PROJECT_ID}_data:
  pnpm-store:
    external: true
    name: doce-global-pnpm-store
  opencode-bin:
  opencode-data:
