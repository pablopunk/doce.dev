---
import "@/styles/global.css";
import { SEO } from "astro-seo";
import site from "../site.json";
import { ModeToggle } from "@/components/ModeToggle";

const appEnv = import.meta.env.APP_ENV || "development";

const allowIndexing = appEnv === "production";
const robotsContent = allowIndexing ? "index, follow" : "noindex, nofollow";

const { title, description = site.description } = Astro.props;

const isIndexPage = Astro.url.pathname === "/";

const DEFAULT_TITLE = site.name;

const pageTitle = isIndexPage ? DEFAULT_TITLE : title || DEFAULT_TITLE;
const titleTemplate = isIndexPage ? "%s" : `%s | ${site.name}`;
---

<script is:inline>
	const getThemePreference = () => {
		if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
			return localStorage.getItem('theme');
		}
		return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
	};
	const isDark = getThemePreference() === 'dark';
	document.documentElement.classList[isDark ? 'add' : 'remove']('dark');

	if (typeof localStorage !== 'undefined') {
		const observer = new MutationObserver(() => {
			const isDark = document.documentElement.classList.contains('dark');
			localStorage.setItem('theme', isDark ? 'dark' : 'light');
		});
		observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
	}
</script>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <SEO
      title={pageTitle}
      titleDefault={DEFAULT_TITLE}
      titleTemplate={titleTemplate}
      description={description}
      canonical={Astro.url.toString()}
      noindex={!allowIndexing}
      nofollow={!allowIndexing}
      openGraph={{
          basic: {
            title: title || site.name,
            type: "website",
            image: `${site.url}/og.png`,
            url: Astro.url.toString(),
          },
          image: {
            alt: site.name,

          width: 1600,
          height: 800,
          type: "image/png",
        },
        optional: {
          description,
          siteName: site.name,
          locale: "en_US",
        },
      }}
      twitter={{
        card: "summary_large_image",
        site: site.twitter.site,
        creator: site.twitter.creator,
        title: title || site.name,
        description,
        image: `${site.url}/og.png`,
        imageAlt: site.name,
      }}

      extend={{
        meta: [
          { name: "author", content: site.author },
          {
            name: "keywords",
            content:
              "astro, web development, javascript, typescript, modern web",
          },
          { name: "googlebot", content: robotsContent },
          { name: "theme-color", content: "#000000" },
          { name: "msapplication-TileColor", content: "#000000" },
        ],
        link: [
          {
            rel: "apple-touch-icon",
            sizes: "180x180",
            href: "/apple-touch-icon.png",
          },
          {
            rel: "icon",
            type: "image/png",
            sizes: "32x32",
            href: "/favicon-32x32.png",
          },
          {
            rel: "icon",
            type: "image/png",
            sizes: "16x16",
            href: "/favicon-16x16.png",
          },
          {
            rel: "icon",
            type: "image/x-icon",
            href: "/favicon.ico",
          },
          {
            rel: "icon",
            type: "image/png",
            sizes: "192x192",
            href: "/android-chrome-192x192.png",
          },
          {
            rel: "icon",
            type: "image/png",
            sizes: "512x512",
            href: "/android-chrome-512x512.png",
          },
        ],
      }}
    />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="sitemap" href="/sitemap-index.xml" />
  </head>
  <body class="bg-background text-foreground">
    <header class="border-b border-border bg-background/80 backdrop-blur">
      <div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-4">
        <a href="/" class="text-xl font-bold tracking-tight">
          {site.name}
        </a>
        <ModeToggle client:load />
      </div>
    </header>
    <main class="max-w-7xl mx-auto px-4 py-8">
      <slot />
    </main>
  </body>
</html>

